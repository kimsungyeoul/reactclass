
# 🔍 Node.js의 `package-lock.json` 완벽 정리: 왜 존재하고 어떻게 작동하는가?

Node.js 기반 프로젝트를 하다 보면 `package.json`과 함께 자동으로 생성되는 `package-lock.json` 파일을 보게 됩니다. 많은 초보 개발자들이 **"이거 삭제해도 되는 파일 아니야?"** 라고 묻곤 합니다. 그러나 `package-lock.json`은 Node.js 생태계에서 **재현 가능한 설치(Deterministic install)** 와 **보안**, **버전 충돌 방지**에 핵심적인 역할을 합니다.

이 챕터에서는 `package-lock.json`의 역할, 구조, 동작 방식, 그리고 실무에서의 활용 전략까지 깊이 있게 정리해보겠습니다.

---

## 📦 package.json vs package-lock.json

| 항목        | package.json                    | package-lock.json         |
| --------- | ------------------------------- | ------------------------- |
| 목적        | 의존성 선언 및 메타데이터                  | 실제 설치된 의존성 트리 저장          |
| 작성자       | 개발자 수동 작성 또는 `npm init`         | `npm install` 시 자동 생성     |
| 버전 관리     | 버전 범위 (e.g. `^1.2.3`, `~1.2.3`) | 고정된 정확한 버전 (e.g. `1.2.3`) |
| Git 커밋 대상 | ✅ 반드시 커밋해야 함                    | ✅ 반드시 커밋해야 함              |

---

## 🔑 1. package-lock.json이 필요한 이유

### 1.1 의존성 버전 고정

`package.json`에는 보통 아래처럼 **범위 지정 버전**이 사용됩니다.

```json
"dependencies": {
  "axios": "^1.7.0"
}
```

이 의미는:

* `npm install` 시 `1.7.x` 중 **가장 최신 버전**을 설치하라는 뜻입니다.
* 다른 개발자가 `npm install`을 실행할 때 **다른 하위 버전**이 설치될 수 있습니다.

➡️ 결과적으로 팀원마다 설치된 `node_modules`가 다를 수 있고, 버그 발생 시 **재현이 어렵고 디버깅이 복잡**해집니다.

<br>

### 1.2 재현 가능한 빌드

`package-lock.json`은 설치된 **정확한 버전과 모든 의존성 트리**를 저장합니다. 이 파일이 있으면:

* 누구든지 같은 `node_modules`를 재현할 수 있음
* CI/CD 환경에서도 **예측 가능한 설치 결과**를 얻을 수 있음
* 악의적인 패키지 버전 변경(공급망 공격)을 방지 가능

---

## 🔎 2. package-lock.json의 내부 구조

```json
{
  "name": "npm-demo",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "dependencies": {
        "dayjs": "^1.11.10"
      }
    },
    "node_modules/dayjs": {
      "version": "1.11.10",
      "resolved": "https://registry.npmjs.org/dayjs/-/dayjs-1.11.10.tgz",
      "integrity": "sha512-abc123...",
      "engines": {
        "node": ">=0.10.0"
      }
    }
  },
  "dependencies": {
    "dayjs": {
      "version": "1.11.10",
      "resolved": "https://registry.npmjs.org/dayjs/-/dayjs-1.11.10.tgz",
      "integrity": "sha512-abc123..."
    }
  }
}
```

### 구성 요소 설명

| 필드                | 설명                                          |
| ----------------- | ------------------------------------------- |
| `name`, `version` | 루트 프로젝트 정보                                  |
| `lockfileVersion` | lock 파일의 형식 버전 (npm 버전과 매핑)                 |
| `packages`        | 모든 설치된 패키지의 트리                              |
| `dependencies`    | 최상위 의존성 트리                                  |
| `resolved`        | 실제 패키지를 다운받은 URL                            |
| `integrity`       | 무결성 체크를 위한 해시값 (Subresource Integrity, SRI) |

---

## 🛠 3. 실무에서의 활용 전략

### ✅ 반드시 Git에 커밋해야 함

```bash
# .gitignore에 추가하지 마세요 ❌
# package-lock.json은 프로젝트 공유를 위한 핵심 파일입니다.
```

### ✅ 팀 전체의 node\_modules 일관성 보장

* `npm ci` 명령어는 `package-lock.json`을 기반으로 정확하게 설치
* `ci`는 `clean install`의 의미로, CI 환경에서는 필수

```bash
npm ci
```

➡️ `package.json`과 `package-lock.json`이 불일치하면 설치 자체가 중단됩니다. 이로써 **깨진 의존성 방지** 가능.

### ✅ 의존성 해시 충돌 방지

* 보안상 중요한 패키지(예: `jsonwebtoken`, `axios`)가 공격받을 수 있음
* `integrity` 필드를 통해 **무결성 확인** 가능 → 신뢰성 확보

---

## ❓ 자주 묻는 질문 (FAQ)

### Q1. `package-lock.json`은 수동으로 수정해도 되나요?

> ❌ 절대 안 됩니다. 자동 생성 파일이며, 수동 편집 시 오류를 유발할 수 있습니다.

---

### Q2. `npm install` 할 때마다 바뀌는데 왜 그런가요?

> * `package.json`의 버전 범위로 인해 하위 버전 변경 발생
> * OS별 optional dependency 또는 npm 버전 차이로도 달라질 수 있음
> * 동일한 프로젝트에서 **`npm install`과 `npm update`는 서로 다릅니다**

---

### Q3. Yarn에서는 이 역할을 누가 하나요?

> Yarn은 `yarn.lock`이라는 파일이 동일한 역할을 합니다.
> pnpm은 `pnpm-lock.yaml`을 사용합니다.

---

## 📚 마무리

| 요약 항목 | 설명                           |
| ----- | ---------------------------- |
| 존재 이유 | 재현 가능한 의존성 설치, 보안성 강화        |
| 주요 역할 | 실제 설치된 버전과 트리 고정             |
| 실무 팁  | 반드시 Git에 포함, CI는 `npm ci` 사용 |
| 자동 생성 | `npm install` 시 자동 생성됨       |


